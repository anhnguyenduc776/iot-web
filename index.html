<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ Thống Giám Sát IoT</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mqtt/4.3.7/mqtt.min.js"></script>
</head>
<body>
    <div class="sidebar">
        <div class="logo">
            <img src="logotruong.jpg" alt="Logo Trường" onerror="this.src='https://via.placeholder.com/150x150?text=Logo'">
            <h2>Hệ Thống Giám Sát IoT</h2>
        </div>
        <nav>
            <ul>
                <li><a href="#" class="nav-link active" data-page="home"><i class="fas fa-home"></i> Trang chủ</a></li>
                <li><a href="#" class="nav-link" data-page="dashboard"><i class="fas fa-chart-line"></i> Dashboard</a></li>
                <li><a href="#" class="nav-link" data-page="intro"><i class="fas fa-info-circle"></i> Giới thiệu</a></li>
                <li><a href="#" class="nav-link" data-page="settings"><i class="fas fa-cog"></i> Cài đặt</a></li>
                <li><a href="#" class="nav-link" data-page="info"><i class="fas fa-info"></i> Thông tin</a></li>
            </ul>
        </nav>
    </div>

    <div class="main-content">
        <header>
            <div class="header-content">
                <h1>TRƯỜNG ĐẠI HỌC GIAO THÔNG VẬN TẢI</h1>
                <h2>PHÂN HIỆU TẠI TP. HỒ CHÍ MINH</h2>
            </div>
            <div class="user-info">
                <i class="fas fa-user"></i>
            </div>
        </header>

        <!-- Home Page Content -->
        <div class="page-content" id="home-page">
            <div class="home-content">
                <div class="project-intro">
                    <h2>Giới Thiệu Đề Tài</h2>
                    <div class="intro-content">
                        <h3>Hệ Thống Giám Sát Nhiệt Độ Và Nồng Độ Khí Gas Thông Minh</h3>
                        <p>Đề tài nghiên cứu và phát triển hệ thống giám sát thông minh sử dụng công nghệ IoT để theo dõi nhiệt độ và nồng độ khí gas trong môi trường. Hệ thống được thiết kế với các tính năng:</p>
                        <ul>
                            <li>Giám sát nhiệt độ môi trường realtime</li>
                            <li>Đo lường nồng độ khí gas</li>
                            <li>Giao diện web trực quan, dễ sử dụng</li>
                            <li>Kết nối không dây thông qua MQTT</li>
                            <li>Bảo mật dữ liệu</li>
                        </ul>
                    </div>
                </div>

                <div class="system-architecture">
                    <h2>Sơ Đồ Hệ Thống</h2>
                    <div class="architecture-content">
                        <img src="system-diagram.jpg" alt="Sơ đồ hệ thống" onerror="this.src='https://via.placeholder.com/800x400?text=Sơ+đồ+hệ+thống'">
                        <p>Hệ thống được xây dựng dựa trên kiến trúc IoT với các thành phần chính:</p>
                        <ul>
                            <li>Cảm biến nhiệt độ và khí gas</li>
                            <li>Vi điều khiển ESP32</li>
                            <li>Broker MQTT</li>
                            <li>Web Server</li>
                            <li>Giao diện người dùng</li>
                        </ul>
                    </div>
                </div>

                <div class="features">
                    <h2>Tính Năng Chính</h2>
                    <div class="features-grid">
                        <div class="feature-box">
                            <i class="fas fa-thermometer-half"></i>
                            <h3>Giám Sát Nhiệt Độ</h3>
                            <p>Theo dõi nhiệt độ môi trường liên tục với độ chính xác cao</p>
                        </div>
                        <div class="feature-box">
                            <i class="fas fa-smog"></i>
                            <h3>Đo Khí Gas</h3>
                            <p>Phát hiện và cảnh báo khi nồng độ khí gas vượt ngưỡng</p>
                        </div>
                        <div class="feature-box">
                            <i class="fas fa-chart-line"></i>
                            <h3>Thống Kê Dữ Liệu</h3>
                            <p>Hiển thị dữ liệu dạng biểu đồ và báo cáo</p>
                        </div>
                        <div class="feature-box">
                            <i class="fas fa-bell"></i>
                            <h3>Cảnh Báo Thông Minh</h3>
                            <p>Hệ thống cảnh báo khi phát hiện bất thường</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard Content -->
        <div class="page-content" id="dashboard-page" style="display: none;">
            <div class="dashboard">
                <h2 class="dashboard-title">Bảng Điều Khiển Giám Sát</h2>
                <div class="sensor-container">
                    <div class="sensor-box">
                        <h2>Nhiệt Độ</h2>
                        <div class="value" id="temperature">--°C</div>
                        <div class="sensor-icon">
                            <i class="fas fa-thermometer-half"></i>
                        </div>
                        <div class="connection-status" id="temp-status">
                            <span class="status-dot"></span>
                            <span class="status-text">Đang kết nối...</span>
                        </div>
                    </div>
                    <div class="sensor-box">
                        <h2>Nồng Độ Khí Gas</h2>
                        <div class="value" id="gas">-- ppm</div>
                        <div class="sensor-icon">
                            <i class="fas fa-smog"></i>
                        </div>
                        <div class="connection-status" id="gas-status">
                            <span class="status-dot"></span>
                            <span class="status-text">Đang kết nối...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>© 2024 Hệ Thống Giám Sát IoT.</p>
        </footer>
    </div>

    <script>
        // Navigation
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remove active class from all links
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                // Add active class to clicked link
                this.classList.add('active');
                
                // Hide all pages
                document.querySelectorAll('.page-content').forEach(page => {
                    page.style.display = 'none';
                });
                
                // Show selected page
                const pageId = this.getAttribute('data-page') + '-page';
                document.getElementById(pageId).style.display = 'block';
            });
        });

        // MQTT Configuration
        const mqttConfig = {
            host: 'test.mosquitto.org',
            port: 1883,
            protocol: 'ws',
            clientId: 'anhnguyenduc04/iot_' + Math.random().toString(16).substr(2, 8)
        };

        // Topics to subscribe to
        const topics = {
            temperature: 'anhnguyenduc04/iot/temperature',
            gas: 'anhnguyenduc04/iot/gas'
        };

        // Update connection status
        function updateConnectionStatus(elementId, isConnected) {
            const status = document.getElementById(elementId);
            const dot = status.querySelector('.status-dot');
            const text = status.querySelector('.status-text');
            
            if (isConnected) {
                dot.style.backgroundColor = '#4CAF50';
                text.textContent = 'Đã kết nối';
            } else {
                dot.style.backgroundColor = '#f44336';
                text.textContent = 'Mất kết nối';
            }
        }

        // Connect to MQTT broker
        const client = mqtt.connect(mqttConfig);

        // Handle connection
        client.on('connect', () => {
            console.log('Connected to MQTT broker');
            updateConnectionStatus('temp-status', true);
            updateConnectionStatus('gas-status', true);
            
            // Subscribe to topics
            client.subscribe([topics.temperature, topics.gas], (err) => {
                if (err) {
                    console.error('Error subscribing to topics:', err);
                    updateConnectionStatus('temp-status', false);
                    updateConnectionStatus('gas-status', false);
                } else {
                    console.log('Subscribed to topics successfully');
                }
            });
        });

        // Handle incoming messages
        client.on('message', (topic, message) => {
            try {
                const value = parseFloat(message.toString());
                
                if (topic === topics.temperature) {
                    document.getElementById('temperature').textContent = `${value.toFixed(1)}°C`;
                    updateConnectionStatus('temp-status', true);
                } else if (topic === topics.gas) {
                    document.getElementById('gas').textContent = `${value.toFixed(1)} ppm`;
                    updateConnectionStatus('gas-status', true);
                }
            } catch (error) {
                console.error('Error processing message:', error);
            }
        });

        // Handle errors
        client.on('error', (err) => {
            console.error('MQTT Error:', err);
            updateConnectionStatus('temp-status', false);
            updateConnectionStatus('gas-status', false);
        });

        // Handle disconnection
        client.on('close', () => {
            console.log('Disconnected from MQTT broker');
            updateConnectionStatus('temp-status', false);
            updateConnectionStatus('gas-status', false);
        });

        // Handle offline status
        client.on('offline', () => {
            console.log('Client is offline');
            updateConnectionStatus('temp-status', false);
            updateConnectionStatus('gas-status', false);
        });
    </script>
</body>
</html> 